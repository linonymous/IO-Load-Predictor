from __future__ import print_function
import pandas as pd
import torch
import torch.nn as nn
from torch.autograd import Variable
import torch.optim as optim
import numpy as np
from matplotlib import pyplot as plt


class Sequence(nn.Module):
    def __init__(self):
        super(Sequence, self).__init__()
        self.lstm1 = nn.LSTMCell(6, 51)
        self.lstm2 = nn.LSTMCell(51, 51)
        self.linear = nn.Linear(51, 1)

    def forward(self, input, future = 0):
        h_t = Variable(torch.zeros(input.size(0), 51).double(), requires_grad=False)
        c_t = Variable(torch.zeros(input.size(0), 51).double(), requires_grad=False)
        h_t2 = Variable(torch.zeros(input.size(0), 51).double(), requires_grad=False)
        c_t2 = Variable(torch.zeros(input.size(0), 51).double(), requires_grad=False)
        h_t, c_t = self.lstm1(input, (h_t, c_t))
        h_t2, c_t2 = self.lstm2(h_t, (h_t2, c_t2))
        output = self.linear(h_t2)
        return output


if __name__ == '__main__':
    # seed the values
    np.random.seed(0)
    torch.manual_seed(0)

    # load and normalize the data
    df = pd.read_csv("sar.csv", header=None)
    print(df.head())
    df[2] = (df[2] - 2018)
    df[0] = (df[0] - df[0].min()) / (df[0].max() - df[0].min())
    df[1] = (df[1] - 1)
    df[3] = (df[3] - df[3].min()) / (df[3].max() - df[3].min())
    df[4] = (df[4] - df[4].min()) / (df[4].max() - df[4].min())
    print(df.head())

    # Prepare pytorch Variables for train and test set
    data = df.as_matrix()
    input = Variable(torch.from_numpy(data[:-100, :-1]), requires_grad=False)
    target = Variable(torch.from_numpy(data[:-100, -1:]), requires_grad=False)
    test_input = Variable(torch.from_numpy(data[-100:, :-1]), requires_grad=False)
    test_target = Variable(torch.from_numpy(data[-100:, -1:]), requires_grad=False)

    # Set the hyperparameters
    epoch = 31
    learning_rate = 0.8

    # Initialize the model, loss function and optimizer
    seq = Sequence()
    seq.double()
    optimizer = optim.LBFGS(seq.parameters(), lr=learning_rate)
    criterion = nn.MSELoss()

    # Initialize the train loss and test loss values
    tr_loss = []
    te_loss = []

    # Train the model
    for i in range(epoch):
        print('STEP: ', i)
        def closure():
            optimizer.zero_grad()
            out = seq(input)
            loss = criterion(out, target)
            print('Train loss:', loss.data.numpy()[0])
            test_loss = criterion(seq(test_input), test_target)
            print('Test Loss:', test_loss.data.numpy()[0])
            tr_loss.append(loss.data.numpy()[0])
            te_loss.append(test_loss.data.numpy()[0])
            loss.backward()
            return loss
        optimizer.step(closure)

    # Calculate the MSE for the trained model on test set
    pred = seq(test_input)
    loss = criterion(pred, test_target)
    print("Mean Squared Error on Test Set:", loss.data[0])

    # save the model
    checkpoint = {'state_dict': seq.state_dict()}
    with open('lstm_model.net', 'wb') as f:
        torch.save(checkpoint, f)

    # Plot the training curves for train and test loss
    plt.plot(tr_loss[4:], 'r')
    plt.plot(te_loss[4:], 'b')
    plt.show()

    # calculate Mean Absolute Percent Error
    err = 0.0
    c = 0
    for x, y in zip(pred, test_target):
        err += (max(x.data[0], y.data[0]) - min(x.data[0], y.data[0]))/y.data[0]
        c += 1
    print(f'MPAE : {(err/c)*100}')



"""
Output:

    0  1     2  3   4  5      6
0  18  1  2018  0   3  1  94.11
1  18  1  2018  0   6  1  83.67
2  18  1  2018  0   9  1  90.63
3  18  1  2018  0  12  1  89.30
4  18  1  2018  0  15  1  84.86
     0  1  2    3         4  5      6
0  0.0  0  0  0.0  0.052632  1  94.11
1  0.0  0  0  0.0  0.105263  1  83.67
2  0.0  0  0  0.0  0.157895  1  90.63
3  0.0  0  0  0.0  0.210526  1  89.30
4  0.0  0  0  0.0  0.263158  1  84.86
STEP:  0
Train loss: 8098.444235789375
Test Loss: 8099.5898289891065
Train loss: 8071.308241917523
Test Loss: 8072.461531853956
Train loss: 3007.432395310761
Test Loss: 3007.90887533284
Train loss: 209.06761394835732
Test Loss: 204.23047769311182
Train loss: 27.016810551472236
Test Loss: 24.377304263841314
Train loss: 16.206891933940433
Test Loss: 14.431744944449417
Train loss: 15.880383599695717
Test Loss: 14.267790225779176
Train loss: 15.868455244250278
Test Loss: 14.28618915988763
Train loss: 15.867442250781483
Test Loss: 14.29159344707308
Train loss: 15.866507699719362
Test Loss: 14.294628819316076
Train loss: 15.864048370304342
Test Loss: 14.297649114935698
Train loss: 15.85863915737067
Test Loss: 14.296405034125584
Train loss: 15.846928357144872
Test Loss: 14.280567500497634
Train loss: 15.823774964146017
Test Loss: 14.230647189720743
Train loss: 15.784875995591502
Test Loss: 14.138091273080214
Train loss: 15.73491223909121
Test Loss: 14.066298914913498
Train loss: 15.697953866010485
Test Loss: 14.126127516044702
Train loss: 15.69131791031933
Test Loss: 14.198404198764733
Train loss: 15.69035297577975
Test Loss: 14.21197883051992
Train loss: 15.689651830643882
Test Loss: 14.213452643392191
STEP:  1
Train loss: 15.689148102661411
Test Loss: 14.209566955199147
Train loss: 15.688052152684325
Test Loss: 14.202182294215755
Train loss: 15.685167606808143
Test Loss: 14.187312812945688
Train loss: 15.679853558907396
Test Loss: 14.165915785337825
Train loss: 15.673143834847478
Test Loss: 14.149777036724704
Train loss: 15.667341291114672
Test Loss: 14.158886169869424
Train loss: 15.665867501801587
Test Loss: 14.17055335905698
Train loss: 15.665597016363536
Test Loss: 14.175660413646296
Train loss: 15.665408704997777
Test Loss: 14.179645900043015
Train loss: 15.665021111451068
Test Loss: 14.187762875026399
Train loss: 15.664238507286438
Test Loss: 14.205218337619323
Train loss: 15.663017887755576
Test Loss: 14.237755688111575
Train loss: 15.661825958751153
Test Loss: 14.265469701608858
Train loss: 15.6612057495661
Test Loss: 14.261569533341003
Train loss: 15.660881605005844
Test Loss: 14.24535987592619
Train loss: 15.660469894726315
Test Loss: 14.228159626120796
Train loss: 15.660004967580411
Test Loss: 14.20791048130433
Train loss: 15.659467850299176
Test Loss: 14.18994624764349
Train loss: 15.658531338840621
Test Loss: 14.162473093753032
Train loss: 15.657178298268972
Test Loss: 14.127878737821954
STEP:  2
Train loss: 15.655141199896883
Test Loss: 14.084930306509495
Train loss: 15.64991872325051
Test Loss: 13.990745284204195
Train loss: 15.654096806550328
Test Loss: 13.871447180160892
Train loss: 15.641749539197416
Test Loss: 13.870261643135827
Train loss: 15.638296753025168
Test Loss: 14.02661900068566
Train loss: 15.629294277491617
Test Loss: 13.941999352302695
Train loss: 15.62427335250381
Test Loss: 13.898931207101896
Train loss: 15.618846979393693
Test Loss: 13.911036306675832
Train loss: 15.594315935809774
Test Loss: 13.952980922572772
Train loss: 15.585991601755625
Test Loss: 14.119767091842341
Train loss: 15.573701619117276
Test Loss: 14.020925103270645
Train loss: 15.569110231943432
Test Loss: 14.014368059153137
Train loss: 15.568727102890955
Test Loss: 14.015995446934522
Train loss: 15.566024569816987
Test Loss: 14.005564836643071
Train loss: 15.559852563153296
Test Loss: 13.962123677896315
Train loss: 15.553793635011983
Test Loss: 13.95426422613026
Train loss: 15.552617700649565
Test Loss: 13.94783206314419
Train loss: 15.551517047078567
Test Loss: 13.936178735117155
Train loss: 15.550526928486203
Test Loss: 13.92820235952116
Train loss: 15.546472543660371
Test Loss: 13.912542694821129
STEP:  3
Train loss: 15.537366077501616
Test Loss: 13.897929044660955
Train loss: 15.528087131807517
Test Loss: 13.878346426894494
Train loss: 15.523941340995325
Test Loss: 13.875101220500627
Train loss: 15.515925580139143
Test Loss: 13.873040371928276
Train loss: 15.50922070830923
Test Loss: 13.892305121117518
Train loss: 15.5058418514525
Test Loss: 13.903292953167277
Train loss: 15.503272496998717
Test Loss: 13.899241531079927
Train loss: 15.500162582406423
Test Loss: 13.900851844607839
Train loss: 15.491863702208228
Test Loss: 13.922064837743402
Train loss: 15.487011193242983
Test Loss: 13.943144788699835
Train loss: 15.485507601198771
Test Loss: 13.943887988878975
Train loss: 15.482917985045546
Test Loss: 13.937878472667968
Train loss: 15.470335872243563
Test Loss: 13.933730561951288
Train loss: 15.465903028713424
Test Loss: 13.935573680510975
Train loss: 15.461955191721811
Test Loss: 13.962410447821924
Train loss: 15.451010847565726
Test Loss: 13.976464212218678
Train loss: 15.442709914154644
Test Loss: 13.99377074958164
Train loss: 15.4345643628283
Test Loss: 14.03538856628529
Train loss: 15.424748082241043
Test Loss: 13.944129105755863
Train loss: 15.417620232587218
Test Loss: 14.003826969913389
STEP:  4
Train loss: 15.410762939420133
Test Loss: 13.973335719734894
Train loss: 15.403477249354003
Test Loss: 14.01722369581226
Train loss: 15.397137024813848
Test Loss: 14.011377850686932
Train loss: 15.39240588981715
Test Loss: 14.023712284209928
Train loss: 15.388695935707117
Test Loss: 14.070717894214123
Train loss: 15.384284711257736
Test Loss: 14.034539790934573
Train loss: 15.375100726837964
Test Loss: 13.986249444391078
Train loss: 15.371063021507975
Test Loss: 14.011259875292225
Train loss: 15.368816234918343
Test Loss: 13.994522249937305
Train loss: 15.364494999316582
Test Loss: 13.963784492987704
Train loss: 15.356756710788886
Test Loss: 13.951414943727194
Train loss: 15.34934880581651
Test Loss: 13.959467915937237
Train loss: 15.343518426139438
Test Loss: 13.956380425574498
Train loss: 15.339884940252801
Test Loss: 13.977324274068932
Train loss: 15.33605267025757
Test Loss: 13.975873961060554
Train loss: 15.331247372799096
Test Loss: 13.973299951257712
Train loss: 15.319233883690941
Test Loss: 13.965645778543049
Train loss: 15.307896697884907
Test Loss: 13.991843261452523
Train loss: 15.303479062753311
Test Loss: 13.983276220072609
Train loss: 15.299770217522653
Test Loss: 14.006332427571724
STEP:  5
Train loss: 15.2933937198808
Test Loss: 14.025820731505464
Train loss: 15.278082806798945
Test Loss: 14.134042199088201
Train loss: 15.261674977172268
Test Loss: 14.128129895464506
Train loss: 15.249268017334366
Test Loss: 14.098798331281149
Train loss: 15.211709322627152
Test Loss: 14.126506528483095
Train loss: 15.21825920911598
Test Loss: 13.951384861641754
Train loss: 15.129126854224413
Test Loss: 13.98575748060334
Train loss: 15.09598502782535
Test Loss: 13.818033052137041
Train loss: 15.052570252069955
Test Loss: 13.854915008661019
Train loss: 15.004136898485983
Test Loss: 13.873736485504025
Train loss: 14.97056032113649
Test Loss: 13.695850821914814
Train loss: 14.96450561311465
Test Loss: 13.323376728322382
Train loss: 14.926445792113123
Test Loss: 13.36369940748316
Train loss: 14.894767437691609
Test Loss: 13.374896930871422
Train loss: 14.850437603792734
Test Loss: 13.237871217615718
Train loss: 14.677267860900871
Test Loss: 12.930059814874499
Train loss: 14.964326871826378
Test Loss: 16.447741847114145
Train loss: 14.5851725968489
Test Loss: 13.197467671270644
Train loss: 14.579630014677
Test Loss: 13.057425208394527
Train loss: 14.55727711516418
Test Loss: 13.008699448914003
STEP:  6
Train loss: 14.531159279489167
Test Loss: 13.026576840853963
Train loss: 14.508782920062634
Test Loss: 13.063535864083468
Train loss: 14.46146364128902
Test Loss: 13.055055347096367
Train loss: 14.409585936989226
Test Loss: 13.061475835534198
Train loss: 14.321824876227836
Test Loss: 12.857267762848004
Train loss: 14.226065851462003
Test Loss: 12.524820665818295
Train loss: 14.20631001580656
Test Loss: 12.537867730896675
Train loss: 14.191223620929556
Test Loss: 12.286171406248439
Train loss: 14.17780329004384
Test Loss: 12.328995122046786
Train loss: 14.153753420174818
Test Loss: 12.50578156084273
Train loss: 14.133107558621603
Test Loss: 12.610019910840244
Train loss: 14.110332505953254
Test Loss: 12.844957293004775
Train loss: 14.07153364879147
Test Loss: 13.083443091601024
Train loss: 14.036315497127386
Test Loss: 13.139551345987853
Train loss: 14.028078408511563
Test Loss: 12.99314352917823
Train loss: 14.010137066086923
Test Loss: 12.600505789763352
Train loss: 13.998220449126581
Test Loss: 12.578117967761832
Train loss: 13.991181253464546
Test Loss: 12.507758179886684
Train loss: 13.973067387955735
Test Loss: 12.381296436529013
Train loss: 13.944853568258667
Test Loss: 12.22106827449152
STEP:  7
Train loss: 13.912248610498041
Test Loss: 11.96189599798401
Train loss: 13.864709573299898
Test Loss: 11.734259466628128
Train loss: 13.814703951980613
Test Loss: 11.91500399599362
Train loss: 13.781843338741432
Test Loss: 12.641290082150832
Train loss: 13.761255607576052
Test Loss: 12.548765740865903
Train loss: 13.718072211749092
Test Loss: 12.19851571616777
Train loss: 13.659779386629339
Test Loss: 12.05152370467058
Train loss: 13.623348514919524
Test Loss: 11.829186811043948
Train loss: 13.59722850328916
Test Loss: 11.8764826556856
Train loss: 13.573276263258098
Test Loss: 12.011245999797127
Train loss: 13.617539015393534
Test Loss: 12.536126298753615
Train loss: 13.538285100186393
Test Loss: 12.052192805021914
Train loss: 13.498282297028222
Test Loss: 11.927423956897266
Train loss: 13.46442014438549
Test Loss: 11.8051013743277
Train loss: 13.37828319003269
Test Loss: 11.786920961192909
Train loss: 13.29443757317156
Test Loss: 11.796882618586082
Train loss: 13.23064999182067
Test Loss: 11.931781272761969
Train loss: 13.193727358008184
Test Loss: 11.909258201929392
Train loss: 13.15318801329483
Test Loss: 11.951956976796865
Train loss: 13.096772702996553
Test Loss: 12.109930344177656
STEP:  8
Train loss: 13.057114673327897
Test Loss: 12.293842664881318
Train loss: 12.966641002885215
Test Loss: 12.146601737505623
Train loss: 12.94255133956434
Test Loss: 12.065807310228815
Train loss: 12.879702047655208
Test Loss: 12.072231314014136
Train loss: 12.803257808623476
Test Loss: 11.986223600324273
Train loss: 12.747780092154365
Test Loss: 12.224433149054759
Train loss: 12.710169370876217
Test Loss: 12.273855664387456
Train loss: 12.662519200030095
Test Loss: 12.261596581024977
Train loss: 12.598495134677183
Test Loss: 12.291875650444311
Train loss: 12.493653748088636
Test Loss: 12.322912155572407
Train loss: 12.403653040964613
Test Loss: 12.309249481723873
Train loss: 12.295344746325448
Test Loss: 12.318055945846375
Train loss: 12.175952265770519
Test Loss: 12.454304328044932
Train loss: 12.081565293274503
Test Loss: 12.976940225204071
Train loss: 11.963666708286008
Test Loss: 13.734380904978245
Train loss: 11.91361644402212
Test Loss: 14.175057100020974
Train loss: 11.85392163036633
Test Loss: 14.028871049268801
Train loss: 11.780302335930648
Test Loss: 13.853585842612357
Train loss: 11.690004249276264
Test Loss: 13.967162772448825
Train loss: 11.505469068088166
Test Loss: 13.81254959125296
STEP:  9
Train loss: 11.354791138202618
Test Loss: 13.477000200358843
Train loss: 11.240569650228073
Test Loss: 13.498209479665931
Train loss: 11.150936483079086
Test Loss: 13.236020938632043
Train loss: 10.96677012551845
Test Loss: 13.343184640836864
Train loss: 10.725044601334066
Test Loss: 13.39135289789044
Train loss: 10.618611936338445
Test Loss: 14.023372519031087
Train loss: 10.392702732357723
Test Loss: 13.472599424530301
Train loss: 10.138876426376676
Test Loss: 12.913622918332045
Train loss: 9.979927113503262
Test Loss: 12.56348417119824
Train loss: 9.839404733977
Test Loss: 12.574502830382228
Train loss: 9.645102673045379
Test Loss: 12.646160087014941
Train loss: 9.55031174245055
Test Loss: 12.406674204468347
Train loss: 9.460306818749252
Test Loss: 12.141803034006282
Train loss: 9.353505378214965
Test Loss: 12.127307402165755
Train loss: 9.225299439211174
Test Loss: 12.13833668859239
Train loss: 9.173483742170038
Test Loss: 12.338798394784044
Train loss: 9.089986674457432
Test Loss: 12.215063498893477
Train loss: 8.976049438596684
Test Loss: 11.977102754052906
Train loss: 8.821139567423172
Test Loss: 11.731133199121466
Train loss: 8.701264426463899
Test Loss: 11.277548613704623
STEP:  10
Train loss: 8.608537811268565
Test Loss: 11.092652849070515
Train loss: 8.571913423858092
Test Loss: 10.96778983948156
Train loss: 8.468934168061741
Test Loss: 10.770572828189275
Train loss: 8.348110266559754
Test Loss: 10.878463573057182
Train loss: 8.23240317083618
Test Loss: 11.225136742405823
Train loss: 8.117028056867964
Test Loss: 11.464729123852772
Train loss: 8.041141786367534
Test Loss: 11.990907979424819
Train loss: 7.981616391120236
Test Loss: 11.913263908210725
Train loss: 7.902306479337744
Test Loss: 11.884866642010357
Train loss: 7.832635514448907
Test Loss: 11.795895498944091
Train loss: 7.781724243763326
Test Loss: 11.70873527140933
Train loss: 7.696677792487712
Test Loss: 11.677305206779986
Train loss: 7.644269626447365
Test Loss: 11.530360740568618
Train loss: 7.569893972113972
Test Loss: 11.325538848183115
Train loss: 7.505611486180589
Test Loss: 11.070811636013145
Train loss: 7.466072440407076
Test Loss: 10.936237269911205
Train loss: 7.381478981241429
Test Loss: 10.930097446601476
Train loss: 7.308134176077771
Test Loss: 11.244038376795457
Train loss: 7.278248801482517
Test Loss: 11.4311275175304
Train loss: 7.2608552655563
Test Loss: 11.822661421456763
STEP:  11
Train loss: 7.223120266968993
Test Loss: 11.66953831036326
Train loss: 7.202567794005834
Test Loss: 11.64141984984748
Train loss: 7.182356143662643
Test Loss: 11.652079458643009
Train loss: 7.134551650075899
Test Loss: 11.74702113999416
Train loss: 7.094763302049364
Test Loss: 11.711679133705898
Train loss: 7.0563428928608625
Test Loss: 11.642656831827408
Train loss: 7.016716103515925
Test Loss: 11.447084223425074
Train loss: 6.968644613592783
Test Loss: 11.248787742720928
Train loss: 6.918296542008932
Test Loss: 11.084717418232273
Train loss: 6.859230246081244
Test Loss: 10.949276320969334
Train loss: 6.807231409023507
Test Loss: 11.047093419945131
Train loss: 6.776256203074299
Test Loss: 10.860737230489493
Train loss: 6.749422486809403
Test Loss: 10.885000402354748
Train loss: 6.706064418523598
Test Loss: 11.012423287749806
Train loss: 6.6445479231520075
Test Loss: 11.28191141429178
Train loss: 6.597293783245761
Test Loss: 11.380370652148118
Train loss: 6.541488026528869
Test Loss: 11.193870587028504
Train loss: 6.507954792500949
Test Loss: 11.116082838099603
Train loss: 6.479964721860772
Test Loss: 11.008839118455136
Train loss: 6.446299024620359
Test Loss: 10.852100264204603
STEP:  12
Train loss: 6.415157685788954
Test Loss: 10.822577411442204
Train loss: 6.390071423619474
Test Loss: 10.694795628930526
Train loss: 6.360657944641466
Test Loss: 10.601012568197358
Train loss: 6.324836221108743
Test Loss: 10.566719775449462
Train loss: 6.303597665004408
Test Loss: 10.622927552105805
Train loss: 6.285971929323772
Test Loss: 10.74066709297722
Train loss: 6.2624040912676895
Test Loss: 10.817486503152601
Train loss: 6.2308560903486265
Test Loss: 11.016502083027488
Train loss: 6.207751444994267
Test Loss: 11.449400604184264
Train loss: 6.190400251542851
Test Loss: 11.700856904730022
Train loss: 6.173110225401644
Test Loss: 11.941226204666854
Train loss: 6.148733821198875
Test Loss: 12.0913198836815
Train loss: 6.1218235331295014
Test Loss: 12.376908966476291
Train loss: 6.0985924861868375
Test Loss: 12.399245333152056
Train loss: 6.0757460259662945
Test Loss: 12.582744310149984
Train loss: 6.051339756181507
Test Loss: 12.671235029147594
Train loss: 6.02322417042904
Test Loss: 12.660684909066918
Train loss: 5.9915914169575295
Test Loss: 12.618313977718826
Train loss: 5.962174743464616
Test Loss: 12.40712173269196
Train loss: 5.933779446227813
Test Loss: 12.370193464238987
STEP:  13
Train loss: 5.891154175598009
Test Loss: 12.569585580860947
Train loss: 5.856850605186218
Test Loss: 12.739234508975757
Train loss: 5.830684447842546
Test Loss: 12.8858199646288
Train loss: 5.813150064915696
Test Loss: 13.074777022492443
Train loss: 5.796871536223375
Test Loss: 13.056135468154974
Train loss: 5.78008171939713
Test Loss: 13.025364236726375
Train loss: 5.757814387587874
Test Loss: 13.074831479213547
Train loss: 5.737816365973016
Test Loss: 12.992558548647763
Train loss: 5.718380708995376
Test Loss: 13.182618023286631
Train loss: 5.700528863862204
Test Loss: 13.255487162912651
Train loss: 5.673038308008773
Test Loss: 13.375091190495564
Train loss: 5.646611860145959
Test Loss: 13.381270203805782
Train loss: 5.620821927741842
Test Loss: 13.308614708900187
Train loss: 5.590248560857062
Test Loss: 13.313307870311414
Train loss: 5.5635578405237585
Test Loss: 13.208141250936313
Train loss: 5.543090625852922
Test Loss: 13.181018916696841
Train loss: 5.517642432332031
Test Loss: 13.151245141388845
Train loss: 5.494885872160008
Test Loss: 13.307928119191835
Train loss: 5.477028502322407
Test Loss: 13.374907527275909
Train loss: 5.459274810644014
Test Loss: 13.379008824273264
STEP:  14
Train loss: 5.450719062359435
Test Loss: 13.492262796135652
Train loss: 5.444833580547702
Test Loss: 13.545926421306127
Train loss: 5.433992222650216
Test Loss: 13.557889759832292
Train loss: 5.417921892263063
Test Loss: 13.522305652046875
Train loss: 5.401593794233257
Test Loss: 13.50746345283292
Train loss: 5.385658279879895
Test Loss: 13.388754318265542
Train loss: 5.370423082621904
Test Loss: 13.398924983967364
Train loss: 5.357295136327721
Test Loss: 13.548029914214133
Train loss: 5.3487986409897825
Test Loss: 13.485170038731919
Train loss: 5.342283459483983
Test Loss: 13.554214337535292
Train loss: 5.331676611909198
Test Loss: 13.645463352204152
Train loss: 5.3209670281591235
Test Loss: 13.822877255411512
Train loss: 5.309866860026461
Test Loss: 14.026544660204689
Train loss: 5.299596113818218
Test Loss: 14.18057439143842
Train loss: 5.290967520127177
Test Loss: 14.356481754431304
Train loss: 5.28449017241636
Test Loss: 14.408559622415064
Train loss: 5.280460616233796
Test Loss: 14.47612022216653
Train loss: 5.275720967548616
Test Loss: 14.580092600052351
Train loss: 5.272076772352115
Test Loss: 14.697386333261573
Train loss: 5.266187768264904
Test Loss: 14.857540574433528
STEP:  15
Train loss: 5.252898309890821
Test Loss: 15.181911208841656
Train loss: 5.234033517370393
Test Loss: 15.567288890096131
Train loss: 5.220035252277975
Test Loss: 16.02715469608744
Train loss: 5.2112113350565865
Test Loss: 15.925358323493446
Train loss: 5.203692130386097
Test Loss: 15.698166173605948
Train loss: 5.19957441201984
Test Loss: 15.56832510956241
Train loss: 5.194841847466656
Test Loss: 15.588902224230528
Train loss: 5.188116331063341
Test Loss: 15.713274817081874
Train loss: 5.181806460126969
Test Loss: 16.171574708777452
Train loss: 5.174408545621212
Test Loss: 16.308257504422404
Train loss: 5.166646717026439
Test Loss: 16.612291126425447
Train loss: 5.158949383520075
Test Loss: 16.792091324819772
Train loss: 5.15096824425731
Test Loss: 16.97362565946672
Train loss: 5.142123939222546
Test Loss: 16.927832435470037
Train loss: 5.133594810420571
Test Loss: 16.89615591319107
Train loss: 5.124096527329782
Test Loss: 16.699664350328796
Train loss: 5.116611173971679
Test Loss: 16.676162446074635
Train loss: 5.11241485956464
Test Loss: 16.564803714844956
Train loss: 5.108088525518869
Test Loss: 16.565991968976483
Train loss: 5.101376356666604
Test Loss: 16.57707494786103
STEP:  16
Train loss: 5.095677602983837
Test Loss: 16.639261981609444
Train loss: 5.091240879260383
Test Loss: 16.737775403782745
Train loss: 5.087338487375278
Test Loss: 16.780434241805644
Train loss: 5.084080207570482
Test Loss: 16.80427961341273
Train loss: 5.081271960920852
Test Loss: 16.738997869259734
Train loss: 5.076971861581644
Test Loss: 16.59828765627842
Train loss: 5.071316061594409
Test Loss: 16.304859451922525
Train loss: 5.065691274740973
Test Loss: 16.0642502024473
Train loss: 5.061239215539818
Test Loss: 15.899923006186736
Train loss: 5.056378447507174
Test Loss: 15.727543623414917
Train loss: 5.05364949120142
Test Loss: 15.672748843413272
Train loss: 5.050861155299471
Test Loss: 15.594804463364197
Train loss: 5.0470594385226875
Test Loss: 15.50142681500279
Train loss: 5.043408715279578
Test Loss: 15.420023667475299
Train loss: 5.0406722915703135
Test Loss: 15.531695230609536
Train loss: 5.035582249011137
Test Loss: 15.486160258758833
Train loss: 5.030178154492667
Test Loss: 15.321617278588722
Train loss: 5.024493039730635
Test Loss: 15.287845548706871
Train loss: 5.016593985928135
Test Loss: 14.900660350293718
Train loss: 5.002703201513428
Test Loss: 14.96067366553035
STEP:  17
Train loss: 4.9966682931826965
Test Loss: 14.786670086407183
Train loss: 4.991346060916285
Test Loss: 14.386623579552623
Train loss: 4.98379536796527
Test Loss: 14.43832323984567
Train loss: 4.979447399176643
Test Loss: 14.504498443061788
Train loss: 4.975089585614667
Test Loss: 14.564383444904133
Train loss: 4.970624386258219
Test Loss: 14.644624691826419
Train loss: 4.964756889904831
Test Loss: 14.818362934026684
Train loss: 4.95806016152168
Test Loss: 15.07752986859732
Train loss: 4.952671934310379
Test Loss: 15.174151372056054
Train loss: 4.946714716005027
Test Loss: 15.229539198309602
Train loss: 4.940967310702877
Test Loss: 15.258665593960622
Train loss: 4.935209388244882
Test Loss: 15.335785371810346
Train loss: 4.931128064568719
Test Loss: 15.269233128008285
Train loss: 4.928090015368262
Test Loss: 15.285091279145028
Train loss: 4.924405153993636
Test Loss: 15.27609416044989
Train loss: 4.919465828625339
Test Loss: 15.364836079023648
Train loss: 4.914343171630293
Test Loss: 15.405178386422238
Train loss: 4.91031593392082
Test Loss: 15.36670081102644
Train loss: 4.906480624261692
Test Loss: 15.337551179928859
Train loss: 4.901431028258864
Test Loss: 15.162284153102012
STEP:  18
Train loss: 4.8964585994662615
Test Loss: 14.99738153297044
Train loss: 4.89277445231987
Test Loss: 14.872481782718907
Train loss: 4.8889063024278965
Test Loss: 14.698667382074772
Train loss: 4.885823991472169
Test Loss: 14.565714237369972
Train loss: 4.8829034252651855
Test Loss: 14.377139542366395
Train loss: 4.8802566626673425
Test Loss: 14.32373461722238
Train loss: 4.877680943494248
Test Loss: 14.228972398250068
Train loss: 4.874226018875089
Test Loss: 14.189005896500573
Train loss: 4.870372683796515
Test Loss: 14.165910558983306
Train loss: 4.866928757545363
Test Loss: 14.23221963920671
Train loss: 4.863933278296508
Test Loss: 14.23098474187951
Train loss: 4.860159806807193
Test Loss: 14.295273817034067
Train loss: 4.854258238300205
Test Loss: 14.224284361349111
Train loss: 4.847622324246394
Test Loss: 14.273485281050691
Train loss: 4.842709081572154
Test Loss: 14.315782233585457
Train loss: 4.838448432778732
Test Loss: 14.332888053135399
Train loss: 4.835004292068567
Test Loss: 14.413520555598836
Train loss: 4.830796119917202
Test Loss: 14.482023268174785
Train loss: 4.8260289296871886
Test Loss: 14.703263663113844
Train loss: 4.821730926386426
Test Loss: 14.780330783618428
STEP:  19
Train loss: 4.8177123310824745
Test Loss: 14.864808453663224
Train loss: 4.815321015634522
Test Loss: 14.848195263800942
Train loss: 4.813568664155918
Test Loss: 14.808572080598855
Train loss: 4.811657459228543
Test Loss: 14.761373981774279
Train loss: 4.809526697980568
Test Loss: 14.716403565566354
Train loss: 4.806755647365674
Test Loss: 14.729954630665604
Train loss: 4.801971254888074
Test Loss: 14.872901258157562
Train loss: 4.796495899781636
Test Loss: 15.010150071154897
Train loss: 4.791736062405332
Test Loss: 15.279304174535397
Train loss: 4.7884947491071745
Test Loss: 15.332279705123696
Train loss: 4.785060402666231
Test Loss: 15.387594879899357
Train loss: 4.781837988049997
Test Loss: 15.420179899154872
Train loss: 4.776568653503033
Test Loss: 15.484572256636135
Train loss: 4.771859806681671
Test Loss: 15.45259620964633
Train loss: 4.767458247237211
Test Loss: 15.421035085544677
Train loss: 4.763492257410652
Test Loss: 15.37006440746427
Train loss: 4.760167323744703
Test Loss: 15.299556858331444
Train loss: 4.756812389377382
Test Loss: 15.200187894176018
Train loss: 4.753025693407579
Test Loss: 15.159503251901377
Train loss: 4.749282385092712
Test Loss: 15.131847080875536
STEP:  20
Train loss: 4.745624475556275
Test Loss: 15.228943917902386
Train loss: 4.74242639971299
Test Loss: 15.269642180711962
Train loss: 4.7397262467764945
Test Loss: 15.33747966926392
Train loss: 4.736617541502179
Test Loss: 15.356779028525425
Train loss: 4.733797009140765
Test Loss: 15.443702049591714
Train loss: 4.731756562922322
Test Loss: 15.387231072764678
Train loss: 4.730461268643567
Test Loss: 15.368860617123218
Train loss: 4.728601833534432
Test Loss: 15.362803887919437
Train loss: 4.726829374731965
Test Loss: 15.318639075837497
Train loss: 4.723638202232356
Test Loss: 15.195301814693924
Train loss: 4.721198465428794
Test Loss: 15.1529303975273
Train loss: 4.718796226922767
Test Loss: 15.065905993895756
Train loss: 4.716847321641467
Test Loss: 15.006289406536782
Train loss: 4.715046138038973
Test Loss: 14.979476111117974
Train loss: 4.712728503834113
Test Loss: 14.894791432004858
Train loss: 4.709350261085211
Test Loss: 14.803098841606063
Train loss: 4.705885417068489
Test Loss: 14.734455604700683
Train loss: 4.702459120902724
Test Loss: 14.612707780175342
Train loss: 4.699665958958673
Test Loss: 14.53679848598537
Train loss: 4.697777402644855
Test Loss: 14.490978657537926
STEP:  21
Train loss: 4.696486207162715
Test Loss: 14.474100048180267
Train loss: 4.695089103937736
Test Loss: 14.428038664381592
Train loss: 4.693926042325176
Test Loss: 14.431056383999353
Train loss: 4.692410192547612
Test Loss: 14.399789321588042
Train loss: 4.689787872726294
Test Loss: 14.458348708653904
Train loss: 4.6875680545111535
Test Loss: 14.363024879916614
Train loss: 4.68545650346494
Test Loss: 14.286046066287563
Train loss: 4.683743319879158
Test Loss: 14.17420591598271
Train loss: 4.682166230875501
Test Loss: 14.156492402875848
Train loss: 4.680243650079637
Test Loss: 14.143495657373776
Train loss: 4.67782213770001
Test Loss: 14.186505226349222
Train loss: 4.675244785044716
Test Loss: 14.197484495282415
Train loss: 4.672718103893025
Test Loss: 14.125050489299497
Train loss: 4.670913392789138
Test Loss: 14.197279534758124
Train loss: 4.669635399698033
Test Loss: 14.148400586144572
Train loss: 4.668707167780648
Test Loss: 14.110235040096804
Train loss: 4.667815231484254
Test Loss: 14.081369732609225
Train loss: 4.666480220991958
Test Loss: 13.992478012225813
Train loss: 4.664879363716851
Test Loss: 13.942487695038228
Train loss: 4.663517351455345
Test Loss: 13.839488543097739
STEP:  22
Train loss: 4.662294091675574
Test Loss: 13.8202720334851
Train loss: 4.660809652241834
Test Loss: 13.757489423098912
Train loss: 4.658983891423563
Test Loss: 13.729072423272019
Train loss: 4.65772332036714
Test Loss: 13.693139170465859
Train loss: 4.656396033932917
Test Loss: 13.663217068987917
Train loss: 4.654418986705154
Test Loss: 13.629876871062102
Train loss: 4.653509481717196
Test Loss: 13.426272685890973
Train loss: 4.6511587252900615
Test Loss: 13.485881280602328
Train loss: 4.649571334345355
Test Loss: 13.540676433127736
Train loss: 4.64806659113105
Test Loss: 13.541494101233509
Train loss: 4.646839360233287
Test Loss: 13.566162793670301
Train loss: 4.645182674941637
Test Loss: 13.516587533793343
Train loss: 4.643564109886783
Test Loss: 13.511455592143104
Train loss: 4.641504428899443
Test Loss: 13.503628067951741
Train loss: 4.639236981878234
Test Loss: 13.503859106781393
Train loss: 4.63751627265046
Test Loss: 13.559388277005073
Train loss: 4.635787526088157
Test Loss: 13.556497213134035
Train loss: 4.63450995899307
Test Loss: 13.578393237262324
Train loss: 4.633062190663839
Test Loss: 13.624218129609552
Train loss: 4.63136054816182
Test Loss: 13.684786170629437
STEP:  23
Train loss: 4.63009448009793
Test Loss: 13.732632926943262
Train loss: 4.629062690879008
Test Loss: 13.807694776238566
Train loss: 4.628337135296337
Test Loss: 13.815956985680282
Train loss: 4.627518752745191
Test Loss: 13.83734127115674
Train loss: 4.626825812767505
Test Loss: 13.852042891843993
Train loss: 4.625516853159826
Test Loss: 13.889075132393536
Train loss: 4.623647084715655
Test Loss: 13.885455240856245
Train loss: 4.62194133264245
Test Loss: 13.885549173932965
Train loss: 4.620920613023882
Test Loss: 13.85613339232392
Train loss: 4.620148277299072
Test Loss: 13.833310365711727
Train loss: 4.619434083627291
Test Loss: 13.80427653205056
Train loss: 4.618645660199273
Test Loss: 13.822318759288851
Train loss: 4.617768469246472
Test Loss: 13.835217143859062
Train loss: 4.616598907044651
Test Loss: 13.826922563238824
Train loss: 4.615139736069202
Test Loss: 13.8425536163737
Train loss: 4.614182500595527
Test Loss: 13.735815801052274
Train loss: 4.613345621625059
Test Loss: 13.708670725014272
Train loss: 4.612540779899848
Test Loss: 13.668309245124977
Train loss: 4.611869531209427
Test Loss: 13.614375994798984
Train loss: 4.611201809017799
Test Loss: 13.581381118228357
STEP:  24
Train loss: 4.610256205509378
Test Loss: 13.55398250040709
Train loss: 4.608916705680007
Test Loss: 13.578225198863915
Train loss: 4.607368372232769
Test Loss: 13.611811687185781
Train loss: 4.605805617898183
Test Loss: 13.71176894834725
Train loss: 4.604227693871894
Test Loss: 13.757662407910754
Train loss: 4.603011199560486
Test Loss: 13.77952229844346
Train loss: 4.6019104513566855
Test Loss: 13.749944658427077
Train loss: 4.6011849180463456
Test Loss: 13.689014967719881
Train loss: 4.600474044321386
Test Loss: 13.597569170474799
Train loss: 4.5996768731607185
Test Loss: 13.546314197125925
Train loss: 4.598829504122073
Test Loss: 13.496489511915653
Train loss: 4.598204883595394
Test Loss: 13.509439475444697
Train loss: 4.597532795593169
Test Loss: 13.547776951473047
Train loss: 4.596849849384237
Test Loss: 13.566000182186965
Train loss: 4.595628218327764
Test Loss: 13.599775421961247
Train loss: 4.5942427451407415
Test Loss: 13.57100652267917
Train loss: 4.593114686592843
Test Loss: 13.528944530772808
Train loss: 4.5918932748364405
Test Loss: 13.446893540222522
Train loss: 4.590923058178305
Test Loss: 13.390742226187506
Train loss: 4.58990982303829
Test Loss: 13.373337113891013
STEP:  25
Train loss: 4.588515430425496
Test Loss: 13.351864949943804
Train loss: 4.587114721053919
Test Loss: 13.431824512566706
Train loss: 4.585821355889485
Test Loss: 13.524053588458496
Train loss: 4.584886624514789
Test Loss: 13.590439527875745
Train loss: 4.584247113809993
Test Loss: 13.65615831076125
Train loss: 4.583646192661043
Test Loss: 13.666040792513968
Train loss: 4.582918044975659
Test Loss: 13.707904119845864
Train loss: 4.582195206912977
Test Loss: 13.698074667935519
Train loss: 4.581214810992642
Test Loss: 13.683881872432128
Train loss: 4.580258907641787
Test Loss: 13.683198504675673
Train loss: 4.579230532388375
Test Loss: 13.724967621913954
Train loss: 4.577795955060281
Test Loss: 13.78377125725983
Train loss: 4.576634880704659
Test Loss: 13.888810415931134
Train loss: 4.575811834000998
Test Loss: 13.93314069991617
Train loss: 4.575030138366078
Test Loss: 13.924729639477235
Train loss: 4.574179625885508
Test Loss: 13.91735289687942
Train loss: 4.573264401755676
Test Loss: 13.878851527529468
Train loss: 4.57190398325425
Test Loss: 13.793901597064098
Train loss: 4.570560588305095
Test Loss: 13.66954102896216
Train loss: 4.569158647569396
Test Loss: 13.620983802443805
STEP:  26
Train loss: 4.568217893264172
Test Loss: 13.574517245817553
Train loss: 4.567440659187741
Test Loss: 13.584079677942903
Train loss: 4.566716158786627
Test Loss: 13.565917738457133
Train loss: 4.5661723632218445
Test Loss: 13.565993768681643
Train loss: 4.56534503959788
Test Loss: 13.59429025802419
Train loss: 4.564686744137223
Test Loss: 13.616736718797588
Train loss: 4.563627163193153
Test Loss: 13.647836439471535
Train loss: 4.56241232778351
Test Loss: 13.640233176166994
Train loss: 4.561127075511655
Test Loss: 13.621173379038
Train loss: 4.55998580934706
Test Loss: 13.516143781306603
Train loss: 4.5585350441028005
Test Loss: 13.339271499308445
Train loss: 4.556906685564934
Test Loss: 13.146282080838642
Train loss: 4.555023830436871
Test Loss: 12.951308562366773
Train loss: 4.552168155541898
Test Loss: 12.707401117197513
Train loss: 4.549866926516785
Test Loss: 12.563021341946932
Train loss: 4.548338715493435
Test Loss: 12.454506686656243
Train loss: 4.546866140730348
Test Loss: 12.449420229129405
Train loss: 4.5452273197717705
Test Loss: 12.433767817490455
Train loss: 4.54275795431292
Test Loss: 12.365633225113656
Train loss: 4.540339195534549
Test Loss: 12.238544550806562
STEP:  27
Train loss: 4.5379104911564365
Test Loss: 12.099647605480135
Train loss: 4.5358894227406825
Test Loss: 11.968968691134837
Train loss: 4.533997484206262
Test Loss: 11.825770981257751
Train loss: 4.532982388826309
Test Loss: 11.772866774235201
Train loss: 4.531672805443864
Test Loss: 11.747064795275014
Train loss: 4.530674270628518
Test Loss: 11.778004426803706
Train loss: 4.529903972537189
Test Loss: 11.804845668659363
Train loss: 4.528728524901564
Test Loss: 11.83394411509751
Train loss: 4.527722985672296
Test Loss: 11.836454451582846
Train loss: 4.5267659791626675
Test Loss: 11.801276200426853
Train loss: 4.5256831100876775
Test Loss: 11.755969258145429
Train loss: 4.52472094299695
Test Loss: 11.690815189344784
Train loss: 4.523462295928393
Test Loss: 11.63053575208129
Train loss: 4.522083026346249
Test Loss: 11.543698440776643
Train loss: 4.521052215487991
Test Loss: 11.482297780375527
Train loss: 4.520238633067041
Test Loss: 11.45158415148207
Train loss: 4.5196128933343624
Test Loss: 11.401780298489713
Train loss: 4.518972862237211
Test Loss: 11.365579946511197
Train loss: 4.518043665770946
Test Loss: 11.290611980367624
Train loss: 4.516980883784391
Test Loss: 11.17965605523873
STEP:  28
Train loss: 4.515931837284115
Test Loss: 11.086642729553427
Train loss: 4.514886600804097
Test Loss: 10.998857117079144
Train loss: 4.513895874251013
Test Loss: 10.943672254176333
Train loss: 4.512866110047646
Test Loss: 10.967255053574968
Train loss: 4.511809554541741
Test Loss: 10.938417531566536
Train loss: 4.510805718227126
Test Loss: 10.957890708810785
Train loss: 4.509655501292538
Test Loss: 10.861897806670692
Train loss: 4.508342522870243
Test Loss: 10.840812582652356
Train loss: 4.507241474710238
Test Loss: 10.781825255610304
Train loss: 4.505563927261333
Test Loss: 10.61997688139972
Train loss: 4.504088581155017
Test Loss: 10.449106222306927
Train loss: 4.502637392711143
Test Loss: 10.225171377197032
Train loss: 4.501406165127557
Test Loss: 10.059088421016634
Train loss: 4.500126591128449
Test Loss: 9.913448273472557
Train loss: 4.498694478045975
Test Loss: 9.780684127780198
Train loss: 4.496696903115697
Test Loss: 9.520240019870524
Train loss: 4.49493328629677
Test Loss: 9.32995554865203
Train loss: 4.49352796707838
Test Loss: 9.182298038311137
Train loss: 4.491987028390673
Test Loss: 9.105254919139202
Train loss: 4.49100026565537
Test Loss: 8.961719626614537
STEP:  29
Train loss: 4.489394899218979
Test Loss: 8.904882467133952
Train loss: 4.487777731061088
Test Loss: 8.802275705266613
Train loss: 4.485464153451344
Test Loss: 8.598834852682739
Train loss: 4.483599765692345
Test Loss: 8.442136398848705
Train loss: 4.481980869884863
Test Loss: 8.239801466333669
Train loss: 4.479878507783637
Test Loss: 8.124758304898362
Train loss: 4.477209100424271
Test Loss: 7.844522915869602
Train loss: 4.4749572240023845
Test Loss: 7.762744670839594
Train loss: 4.4730049407590915
Test Loss: 7.666285971924646
Train loss: 4.4714618178938705
Test Loss: 7.600811418729757
Train loss: 4.470186142998044
Test Loss: 7.553136354830505
Train loss: 4.468937504763254
Test Loss: 7.498883443313211
Train loss: 4.46777295819178
Test Loss: 7.462763500685296
Train loss: 4.466734514362243
Test Loss: 7.436261630901245
Train loss: 4.465527570817272
Test Loss: 7.42569859313662
Train loss: 4.464469031652179
Test Loss: 7.4068953389334915
Train loss: 4.463465747660012
Test Loss: 7.411125362460285
Train loss: 4.461998455411151
Test Loss: 7.404128463681712
Train loss: 4.460150061775284
Test Loss: 7.402499233036558
Train loss: 4.458715373432431
Test Loss: 7.407942344776661
STEP:  30
Train loss: 4.457138514229453
Test Loss: 7.4121226915563625
Train loss: 4.4551667841386
Test Loss: 7.431925270269801
Train loss: 4.452996505875015
Test Loss: 7.4279639407504305
Train loss: 4.449919661612082
Test Loss: 7.409665380869228
Train loss: 4.447710131746708
Test Loss: 7.396595018362113
Train loss: 4.446338230610036
Test Loss: 7.33642474784294
Train loss: 4.444641279168422
Test Loss: 7.337978450917462
Train loss: 4.443234144880294
Test Loss: 7.334242001874219
Train loss: 4.4415254926891
Test Loss: 7.320582097765492
Train loss: 4.439627751360433
Test Loss: 7.319640858529048
Train loss: 4.437522757736345
Test Loss: 7.320048763872617
Train loss: 4.435424231968947
Test Loss: 7.35026449528756
Train loss: 4.4337846002836
Test Loss: 7.375494453187553
Train loss: 4.431992760819359
Test Loss: 7.40327275600874
Train loss: 4.42956842789636
Test Loss: 7.444552622704822
Train loss: 4.427102513422981
Test Loss: 7.464508347841696
Train loss: 4.425043204501607
Test Loss: 7.492453368028185
Train loss: 4.422805656537288
Test Loss: 7.518484179748258
Train loss: 4.421160144929458
Test Loss: 7.5286776452355495
Train loss: 4.419706365380346
Test Loss: 7.513180906519193
Mean Squared Error on Test Set: 7.553039852371561
MPAE : 1.9981103907233326

Process finished with exit code 0


"""